<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微信小程序网络请求配置指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff6b81;
            margin-bottom: 20px;
        }
        h2 {
            color: #333;
            margin-top: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        code {
            background-color: #f8f8f8;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .step {
            margin-bottom: 20px;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .note {
            background-color: #fff8e1;
            padding: 15px;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>微信小程序网络请求配置指南</h1>
        
        <h2>问题描述</h2>
        <p>微信小程序在请求网络时出现错误：<code>http://localhost:3000 不在以下 request 合法域名列表中</code>。</p>
        
        <h2>解决方案</h2>
        
        <div class="step">
            <h3>步骤 1: 配置 project.config.json</h3>
            <p>在项目根目录的 <code>project.config.json</code> 文件中，添加网络请求域名配置：</p>
            <pre><code>"setting": {
  // 其他配置...
  "requestDomain": [
    "http://localhost:3000",
    "https://localhost:3000"
  ]
}</code></pre>
        </div>
        
        <div class="step">
            <h3>步骤 2: 确认基础请求 URL 设置</h3>
            <p>检查 <code>app.js</code> 文件中的 <code>baseUrl</code> 配置，确保指向正确的后端服务地址：</p>
            <pre><code>globalData: {
  userInfo: null,
  token: '',
  baseUrl: 'http://localhost:3000/api'
}</code></pre>
        </div>
        
        <div class="step">
            <h3>步骤 3: 启动后端服务</h3>
            <p>确保后端服务正在运行在指定的端口上：</p>
            <pre><code>cd backend
npm run dev</code></pre>
            <p class="success">✅ 当前后端服务已成功运行在端口 3000 上</p>
        </div>
        
        <h2>当前状态</h2>
        <ul>
            <li>✅ project.config.json 已配置 localhost:3000 为合法请求域名</li>
            <li>✅ app.js 中 baseUrl 已正确设置为 'http://localhost:3000/api'</li>
            <li>✅ 后端服务已成功启动并运行在端口 3000</li>
            <li>⚠️ MongoDB 连接失败 (端口 27017)，但不影响基础功能测试</li>
            <li>✅ 登录接口已修改为返回模拟数据，不依赖数据库</li>
        </ul>
        
        <div class="note">
            <h3>注意事项</h3>
            <ol>
                <li>在微信开发者工具中，可能需要重启工具或重新编译项目才能使域名配置生效</li>
                <li>如果使用真实的远程服务器，需要将域名添加到微信小程序的管理后台</li>
                <li>当前后端服务使用模拟数据提供登录功能，适合开发测试环境</li>
                <li>若要完全功能，需要启动 MongoDB 服务 (默认端口 27017)</li>
            </ol>
        </div>
        
        <h2>开发环境临时解决方案</h2>
        <p>在微信开发者工具中，您可以通过以下方式临时跳过域名校验，这是开发阶段最常用的解决方案：</p>
        <ol>
            <li>点击微信开发者工具右上角的 <strong>"详情"</strong> 按钮</li>
            <li>切换到 <strong>"本地设置"</strong> 标签页</li>
            <li>勾选 <strong>"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"</strong> 选项</li>
            <li>重新编译小程序项目</li>
        </ol>
        
        <div class="note">
            <h3>重要提示</h3>
            <p>此设置仅适用于开发环境调试，正式发布前请确保配置了正确的合法域名！</p>
        </div>
        
        <h2>备用解决方案：使用代理</h2>
        <p>如果上述方法仍然无法解决问题，您可以修改网络请求代码，使用简单的代理方案：</p>
        <pre><code>// 修改 utils/request.js 文件，添加代理支持
// 在请求方法中添加如下代码
let requestUrl = app.globalData.baseUrl + url;

// 开发环境代理（仅在开发环境使用）
if (process.env.NODE_ENV === 'development') {
  requestUrl = 'https://service-xxxx-xxxx-xxxx.gz.apigw.tencentcs.com/release/your_path' + url;
}

wx.request({
  url: requestUrl,
  // 其他配置不变
});</code></pre>
    </div>
</body>
</html>