<!-- pages/activity-detail/activity-detail.wxml -->
<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{isLoading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <!-- æ´»åŠ¨è¯¦æƒ… -->
  <view class="activity-detail" wx:if="{{!isLoading && activityDetail}}">
    <!-- æ´»åŠ¨å›¾ç‰‡è½®æ’­ -->
    <swiper class="image-swiper" indicator-dots="true" autoplay="false">
      <block wx:for="{{activityDetail.images || []}}" wx:key="index">
        <swiper-item>
          <image 
            class="activity-image" 
            src="{{item}}" 
            mode="aspectFill" 
            data-index="{{index}}" 
            bindtap="previewImage"
          ></image>
        </swiper-item>
      </block>
      <swiper-item wx:if="{{!activityDetail.images || activityDetail.images.length === 0}}">
        <image 
          class="activity-image" 
          src="https://picsum.photos/750/300" 
          mode="aspectFill"
        ></image>
      </swiper-item>
    </swiper>
    
    <!-- æ´»åŠ¨ä¿¡æ¯ -->
    <view class="activity-info">
      <!-- æ´»åŠ¨æ ‡é¢˜ -->
      <text class="activity-title">{{activityDetail.title}}</text>
      
      <!-- æ´»åŠ¨åˆ†ç±»å’Œåˆ›å»ºè€… -->
      <view class="activity-header">
        <text class="category-badge">{{activityDetail.category}}</text>
        <text class="creator-info">åˆ›å»ºè€…: {{activityDetail.organizer.nickname || 'åŒ¿åç”¨æˆ·'}}</text>
      </view>
      
      <!-- æ´»åŠ¨æ—¶é—´å’Œåœ°ç‚¹ -->
      <view class="activity-meta">
        <view class="meta-item">
          <text class="meta-icon">ğŸ•</text>
          <text class="meta-text">{{formatTime(activityDetail.startTime)}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ“</text>
          <text class="meta-text">{{activityDetail.location.address}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ‘¥</text>
          <text class="meta-text">ä¸Šé™ {{activityDetail.maxParticipants}}äºº</text>
        </view>
      </view>
      
      <!-- æ´»åŠ¨ä»‹ç» -->
      <view class="activity-description">
        <text class="description-title">æ´»åŠ¨ä»‹ç»</text>
        <text class="description-content">{{activityDetail.description}}</text>
      </view>
      
      <!-- å‚ä¸è€…åˆ—è¡¨ -->
      <view class="participants-section" wx:if="{{participants.length > 0}}">
        <text class="section-title">å‚ä¸è€… ({{participants.length}}/{{activityDetail.maxParticipants}})</text>
        <view class="participants-list">
          <view 
            class="participant-item" 
            wx:for="{{participants}}" 
            wx:key="_id"
            data-user-id="{{item._id}}" 
            bindtap="viewUserProfile"
          >
            <image 
              class="participant-avatar" 
              src="{{item.avatar || 'https://picsum.photos/100/100'}}" 
              mode="aspectFill"
            ></image>
            <text class="participant-name">{{item.nickname}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button 
        class="action-btn primary-btn" 
        type="primary" 
        wx:if="{{!isJoined}}"
        bindtap="joinActivity"
      >
        ç«‹å³æŠ¥å
      </button>
      <button 
        class="action-btn cancel-btn" 
        type="warn" 
        wx:if="{{isJoined}}"
        bindtap="leaveActivity"
      >
        å–æ¶ˆæŠ¥å
      </button>
    </view>
  </view>
</view>